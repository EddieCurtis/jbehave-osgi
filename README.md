#JBehave OGSi

JBehave OGSi was created to able to execute JBehave BDD like stories inside any OSGi environment. 
You can use it to test any kind of OSGi applications that requires to be executed inside a OSGi Container as an Eclipse RCP/SWT applications, OSGi Services, etc.
It can be used with:    
   - Tycho or Pax-Exam in a Maven building;
   - inside any IDE that provides a Junit OSGi environment as Eclipse PDE JUnit Plug-in Test;
   - Interactively inside any OSGi Container that uses Felix GoGo commands (for now only Equinox command is being provided);

It is composed by these components: 

- jbehave-osgi-bundles/org.jbehave.osgi.core, that wraps the JBehave Core API and exposes its functionalities;
- jbehave-osgi-bundles/org.jbehave.osgi.web, that wraps the JBehave Web API and let it be used together with the JBehave-OSGi Core;
- jbehave-osgi-bundles/org.jbehave.osgi.interactive that provides a way to interactively run stories in any OSGi container.
- jbehave-osgi-equinox, which supply Equinox specifics features, as the Felix GoGo based console command that works with JBehave OSGi Interactive.

* the minimum OSGI version needed is 4.3.

 
## Bulding JBehave for OSGi


### Get the sources

1) Clone the JBehave-OSGi git repository into your machine:

	git clone git://github.com/jbehave/jbehave-osgi.git


The JBehave-OSGi components uses different approach to being built.
 
JBehave-OSGi Core, Interactive and Web are built using Maven Bundle Plugin, which uses _POM-first_ approach. 
This means that all information needed in the build is taken from the POM file and a OSGi manifest is generated by a the maven-bundle-plugin.

Equinox components are built using Eclipse Tycho, which uses a _MANIFEST-first_ approach. This mean that all information needed in the build is taken from the bundle manifest.

Its not possible to run both building methods together in the same Maven reactor (in the same running job), so you must to split the build into two phases.


### First build the _POM-first_ projects:
 
2) Go to the root folder where you have cloned the project:

	cd /yourprojects/jbehave-osgi

3) Start the maven profile named **bundles**

	mvn clean install -P bundles
	
This will install the JBehave-OSGi Core, Interactive and Web bundles in your local maven repository.
	
	
### Then build the _MANIFEST-first_ projects:

4) Go to root folder where you have cloned the project

	cd /myprojects/jbehave-osgi

5) Start the maven profile *equinox*: 

	mvn clean verify -P equinox

This will create a P2 repository in the following folder: 

    /myprojects/jbehave-osgi/org.jbehave.osgi.equinox.repository/target/repository 
     
This P2 repository will contain all components and all bundles dependencies needed for JBehave-OSGi to be executed on Equinox.



## Setup Eclipse Development Environment for the JBehave-OSGi

In order to work with the code we recommend you to use Eclipse with M2e plus Tycho plug-in installed.

1) Create a new Eclipse workspace and name it jbehave-osgi

2) Import the projects (except the examples) using the _Maven Import_ into the new workspace. You should see compile errors due to the missing dependencies.

3) Setup the _Target Platform_ of the new workspace:

    - Go to /jbehave-osgi/jbehave-osgi-equinox/eclipse_targets folder and open the jbehave-osgi-kepler_local.target. The eclipse will resolve its contents.
    - After Eclipse has been resolved the target definition file click in the _Set as Target Platform_ link. Eclipse must resolve all compile errors.


  
## Working with the examples

We provided a series of OSGi project to exemplify how you could benefit from JBehave-OSGi. Each provided example has an Eclipse launcher file to easily start it.


### Setup Eclipse Development Environment for the provided Examples

In order to work with the examples we recommend you to use Eclipse with M2e plus Tycho plug-in installed.

1) Create a new Eclipse workspace and name it jbehave-osgi-examples

2) Import the examples projects using the _Maven Import_ into the new workspace. You should see compile errors due to the missing dependencies.

3) Setup the _Target Platform_ of the new workspace:

    - Go to /jbehave-osgi-examples/eclipse_targets folder and open the jbehave-osgi-examples-kepler_remote.target. The eclipse will resolve its contents.
    - After Eclipse has been resolved the target definition file click in the _Set as Target Platform_ link. Eclipse must resolve all compile errors.


### Running the test examples using PDE's Junit Plug-in

#### Trader Equinox Server Test Examples

1) Go to menu "Run", then "Run Configurations..."
2) Select TraderAnnotatedEmbedderRunnerOsgi or TraderAnnotatedPathRunnerOsgi launchers.

   
#### RCP Product Test with SWTBot Examples

1) Go to menu "Run", then "Run Configurations..."
2) Select RCPmailAnnotatedEmbedderRunner or RCPmailAnnotatedPathRunner launchers.



### Running the test examples using M2e/Maven with Tycho

#### Trader Equinox Server Test Example

1) Go to menu "Run", then "Run Configurations..."
2) Select build_jbehave-osgi_example_trader launchers.

   
#### RCP Product Test with SWTBot Example

1) Go to menu "Run", then "Run Configurations..."
2) Selectbuild_jbehave-osgi_example_rcpmail launchers.


    
### Using JBehave-OSGi Interactive Service for Equinox


